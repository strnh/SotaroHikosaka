## [PHP](https://www.php.net/)の管理
* 継続的に管理する観点から、定期的なバージョンアップのサポート
* セキュリティパッチの適宜適用
* 

## 主な業績
* 広告代理店のWEBサービス：　FreeBSDサーバで2005年頃から PHP4.x　⇒　PHP5.4 までサポート
* 古いコードが動作しなくなるなどの問題に対して、PHPバージョン移行の支援


### レガシーWebアプリケーションのモダナイゼーションプロジェクト

**プロジェクト期間**: 2025年7月～2025年11月（継続中）  
**担当領域**: データベース移行、セキュリティ改善、PHP最新バージョン対応

#### 1. プロジェクト背景と課題

高等教育機関向けWebアプリケーションの保守改善を担当。システムは2014年頃からメンテナンスが停滞しており、以下の技術的課題を抱えていた。

- **実行環境の老朽化**: FreeBSD 11.4上でPHP 7.2（サポート終了）にて稼働
- **データベースの課題**: Interbase/FirebirdSQLを使用し、バージョン2.5から最新版への移行が頓挫。年度ごとに複数のデータベースファイル(.gdb)が存在し、スキーマの変更履歴やマイグレーション手順が未文書化
- **CI/CDプロセスの不在**: バージョン管理、自動テスト、デプロイの自動化が未整備
- **セキュリティリスク**: 古いPHPバージョンに起因する脆弱性、SQLインジェクション、XSS等のOWASP Top 10脆弱性の潜在的リスク
- **ドキュメント不足**: 既存担当者の退職により、システム仕様や運用手順の引き継ぎが不十分

#### 2. 実施した技術施策

##### 2.1 データベース統合と移行（2025年11月）

**課題分析**:
- 460ファイルのPHPコードに対して静的解析ツールを開発・実行
- FirebirdSQL接続（ibase_*関数）とSQLite3の混在状況を自動監査
- 34テーブル、複数年度にまたがるデータベースファイルの構造を調査

**移行設計**:
- FirebirdSQLからSQLite3への完全移行を計画
- 複数年度のデータを単一のSQLite3データベースに統合する方針を策定
- スキーマの標準化と一貫性確保

**実装**:
- Firebird SHOWコマンドのダンプからスキーマ自動生成ツール（Python）を開発
- データエクスポート/インポートツール（PHP CLI）を実装
- 重複データの検出・除去スクリプト（Shell/SQL）を作成
- 25テーブルの移行をAI支援開発ツール（GitHub Copilot）を活用して効率的に完了
- トランザクション処理とエラーハンドリングを実装

**成果**:
- 年度別に分散していたデータベースを単一のSQLite3 DBに統合
- スキーマの一貫性を確保し、将来的な年度カラム追加の基盤を構築
- データ整合性チェック機構を導入（NULL値修正、主キー重複除去）

##### 2.2 PHP 8.4対応とコードリファクタリング（2025年10月～）

**段階的な移行戦略**:
- 非推奨関数（`session_register()`, `each()`, `split()`等）の置き換え
- エラーハンドリングの改善（従来のエラー抑制演算子@の削減）
- 型宣言の導入とコードの厳格化

**モダナイゼーション施策**:
- Composerによる依存関係管理の導入
- PHPExcel等のライブラリを最新版（PhpSpreadsheet）へ移行
- Smartyテンプレートエンジンの最新バージョン対応

##### 2.3 開発環境とドキュメント整備

**開発環境の構築**:
- Laravel Homestead (Vagrant)環境のセットアップ手順を作成
- ローカル開発環境での動作確認環境を整備

**ドキュメント体系の確立**:
- データベースマイグレーションガイドの作成（手順書、トラブルシューティング）
- テーブル仕様書34件の作成（Markdown形式、ER図含む）
- PHPスクリプト460ファイルの機能分類ドキュメント（フロントエンド/管理者向け/その他）
- DB利用状況監査レポート（自動生成、CSV/Markdown）

##### 2.4 セキュリティ対策ロードマップの策定

**フェーズ分けによる段階的実装計画**:
- 緊急対策: SQLインジェクション対策（PDOプリペアドステートメント化）、XSS対策（htmlspecialchars適用）、CSRF対策（トークン検証）
- 中期対策: 認証・認可の強化（パスワードハッシュ、セッション管理改善）、入力検証の標準化
- 長期改善: MVCアーキテクチャへの移行、REST API化、フレームワーク採用検討

#### 3. 使用技術とツール

**開発言語・フレームワーク**:
- PHP 7.2 → 8.4（移行作業中）
- Shell Script（Bash/Zsh）、Python 3

**データベース**:
- FirebirdSQL 2.5 → SQLite3（移行完了）

**開発ツール**:
- Git（バージョン管理）
- Composer（PHPパッケージ管理）
- GitHub Copilot（AI支援開発）
- Vagrant（仮想化）、Laravel Homestead

**ライブラリ・パッケージ**:
- PhpSpreadsheet（Excel処理）
- Smarty（テンプレートエンジン）

#### 4. プロジェクト成果と技術的な学び

**定量的成果**:
- 460件のPHPファイルの解析と分類完了
- 34テーブル、複数年度分のデータ統合完了
- データベースアクセスの25%をSQLite3化（残75%は移行作業中）

**技術的成果**:
- レガシーシステムの段階的モダナイゼーション手法の確立
- 複数データソースの統合マイグレーション戦略の設計・実装
- AI支援開発ツールを活用した効率的なコード移行

**プロセス改善**:
- ドキュメント駆動の開発プロセスの導入
- 静的解析による技術的負債の可視化
- フェーズ分けによるリスク管理と段階的な価値提供

#### 5. 今後の展開

**短期（次フェーズ）**:
- PHP 8.4対応の完全完了
- 残りのFirebirdSQL依存コードのSQLite3化
- セキュリティ脆弱性の優先的な修正

**中長期**:
- AWS EC2への移行とクラウドネイティブ化
- CI/CDパイプラインの構築（GitHub Actions等）
- コンテナ化（Docker）による環境の標準化と可搬性向上

